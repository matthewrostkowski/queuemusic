<!DOCTYPE html>
<html lang="en" class="min-h-screen">
<head>
  <title>Queue</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>

  <!-- Fonts from HEAD -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;900&family=Manrope:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- Tailwind from dev branch -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#1db954',
            'bg-elev': '#ffffff',
          }
        }
      }
    }
  </script>

  <!-- Base layout styles from HEAD -->
  <style>
    :root { --ink:#0a0a0b; --muted:#63666a; --line:#ececef; --bg:#f8fafc; --brand:#111827; }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    a{color:var(--brand);text-decoration:none}
    a:hover{text-decoration:underline}
    .container{max-width:960px;margin:0 auto;padding:24px}
    .card{background:#fff;border:1px solid var(--line);border-radius:16px;padding:20px;box-shadow:0 1px 3px rgba(0,0,0,.05)}
    .btn{display:inline-block;padding:10px 14px;border-radius:10px;border:1px solid var(--line);background:#111827;color:#fff}
    .btn.secondary{background:#fff;color:#111827}
    header{position:sticky;top:0;background:#fff;border-bottom:1px solid var(--line);z-index:10}
    header .wrap{display:flex;gap:16px;align-items:center;justify-content:space-between;max-width:960px;margin:0 auto;padding:12px 24px}
    nav a{margin-right:16px;padding-bottom:8px}
    .flash{margin:16px 0;padding:10px 12px;border-radius:8px}
    .flash.notice{background:#eef6ff;border:1px solid #b6daff}
    .flash.alert{background:#fff4e5;border:1px solid #ffd599}
  </style>

  <!-- Tailwind base variables from dev -->
  <style type="text/tailwindcss">
    @layer base {
      :root {
        --bg: #f8fafc;
        --bg-elev: #ffffff;
        --fg: #0a0a0b;
        --primary: #1db954;
        --muted: #63666a;
        --error: #b91c1c;
        --border: #ececef;
        --accent: #111827;
      }
      
      .dark {
        --bg: #0a0a0b;
        --bg-elev: #1a1a1a;
        --fg: #f8fafc;
        --primary: #1ed760;
        --muted: #9ca3af;
        --error: #ef4444;
        --border: #2d2d2d;
        --accent: #1db954;
      }
      
      body {
        @apply bg-[color:var(--bg)] text-[color:var(--fg)];
      }
    }
  </style>

  <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
</head>
<body class="min-h-screen antialiased">
  <header class="sticky top-0 backdrop-blur-sm bg-[color:var(--bg-elev)]/90 border-b border-[color:var(--border)] z-10">
    <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <div class="flex items-center gap-x-8">
          <div class="text-lg font-bold">Queue</div>

          <% if current_user %>
            <nav class="hidden md:flex items-center gap-x-6">
              <% if current_user&.admin? %>
                <%= link_to "Admin Dashboard", admin_dashboard_path, class: "text-sm font-medium text-yellow-500 hover:text-yellow-400 transition-colors" %>
                <%= link_to "Manage Users", admin_users_path, class: "text-sm font-medium text-yellow-500 hover:text-yellow-400 transition-colors" %>
                <%= link_to "Manage Venues", admin_venues_path, class: "text-sm font-medium text-yellow-500 hover:text-yellow-400 transition-colors" %>
                <%= link_to "User Balances", admin_balance_transactions_path, class: "text-sm font-medium text-yellow-500 hover:text-yellow-400 transition-colors" %>
              <% end %>
              <%= link_to "Main", root_path, class: "text-sm font-medium hover:text-[color:var(--primary)] transition-colors" %>
              <%= link_to "Scan", scan_path, class: "text-sm font-medium hover:text-[color:var(--primary)] transition-colors" %>
              <%= link_to "Queue", queue_path, class: "text-sm font-medium hover:text-[color:var(--primary)] transition-colors" %>
              <%= link_to "Search", search_path, class: "text-sm font-medium hover:text-[color:var(--primary)] transition-colors" %>
              <%= link_to "Profile", profile_path, class: "text-sm font-medium hover:text-[color:var(--primary)] transition-colors" %>
            </nav>
          <% end %>
        </div>

        <% if current_user %>
          <div class="flex items-center gap-x-3">
            <div class="px-3 py-1 rounded-lg bg-[color:var(--primary)]/10 border border-[color:var(--primary)]/30">
              <span class="text-sm font-medium text-[color:var(--primary)]"><%= current_user.balance_display %></span>
            </div>
            <span id="current-user" class="text-sm text-[color:var(--muted)]"><%= current_user.display_name %></span>
            <%= button_to "Logout", logout_path, method: :delete,
                  class: "inline-flex items-center gap-2 rounded-lg px-3 py-1.5 text-sm font-medium bg-white/5 border border-white/15 hover:bg-white/10 transition-all",
                  form: { class: "inline" } %>
          </div>
        <% else %>
          <nav>
            <%= link_to "Login", root_path, class: "text-sm font-medium hover:text-[color:var(--primary)] transition-colors" %>
          </nav>
        <% end %>
      </div>
    </div>
  </header>

  <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
    <% flash.each do |type, msg| %>
      <div class="my-4 p-3 rounded-lg text-sm <%= type == 'notice' ? 'bg-blue-50 text-blue-900 border border-blue-200' : 'bg-amber-50 text-amber-900 border border-amber-200' %>">
        <%= msg %>
      </div>
    <% end %>

    <div class="my-8">
      <%= yield %>
    </div>
  </div>
</body>
</html>
